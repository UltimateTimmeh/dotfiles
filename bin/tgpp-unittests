#!/bin/bash
# Config
gui='--gui'
pyformex='/home/tim/Documents/pyformex/pyformex/pyformex --redirect --pyside'
TGPPROOT=/home/tim/Documents/feops/taviguide/taviguide-pp-master

# Backup current working directory.
WDBAK=$(pwd)

# Go to taviguide-pp tests dir.
cd $TGPPROOT/taviguide/tests

# Execute taviguide-pp unit tests from within coverage framework.
python -m coverage run $pyformex $gui run_unittests.py
python -m coverage html --omit='/usr/*','*tests*','*__init__*','/home/tim/Documents/pyformex/*'

# Create timestamped unittest log directory.
LOGDIR=logs/$(date +"%Y-%m-%d_%Hh%Mm%Ss")
mkdir -pv $LOGDIR

# Move the unittest and coverage output to the timestamped directory.
mv htmlcov unittests.log $LOGDIR

# Clean up
rm .coverage

# Go back to original working directory
cd $WDBAK
